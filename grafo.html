<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Grafo do Caminho Crítico</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    body {
      background: #f5f5f5;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
    }
    h1 {
      margin: 10px 0;
    }
    #grafo {
      width: 100%;
      height: 90vh;
      border: 1px solid #ccc;
      background: #fff;
    }
  </style>
</head>
<body>
  <h1>Grafo do Caminho Crítico</h1>
  <div id="grafo"></div>

<script>
  const jsonPath = "grafo.json";

  fetch(jsonPath)
    .then(r => { if(!r.ok) throw new Error(`HTTP ${r.status}`); return r.json(); })
    .then(data => {
      const asId = v => String(v);

      // monta nodes
      const nodes = data.nodes.map(n => ({
        id: asId(n.id),
        label: `${n.id}\nDur: ${n.duration}`,
        color: "#8cc9ff",
        font: { color: "#000" }
      }));

      // monta edges com cor azul FORÇADA (padrão)
      const edges = data.edges.map(e => ({
        from: asId(e.from),
        to: asId(e.to),
        arrows: "to",
        color: { color: "#7aa5e3" },  // força padrão azul
        width: 1
      }));

      // caminho crítico (lista)
      const path = Array.isArray(data.critical_path) ? data.critical_path.map(asId) : [];
      const pathSet = new Set(path);

      // pinta nós do caminho crítico
      path.forEach(id => {
        const node = nodes.find(n => n.id === id);
        if (node) node.color = "#ff4d4d";
      });

      // gera apenas pares CONSECUTIVOS do caminho
      const validPairs = new Set();
      for (let i = 0; i < path.length - 1; i++) {
        validPairs.add(`${path[i]}|${path[i+1]}`);
      }

      // ZERA qualquer pintura antiga e pinta SOMENTE os pares consecutivos
      edges.forEach(e => {
        const key = `${e.from}|${e.to}`;
        if (validPairs.has(key)) {
          e.color = { color: "#ff4d4d" };
          e.width = 3;
        } else {
          // garante que nada fora do caminho fique vermelho
          e.color = { color: "#7aa5e3" };
          e.width = 1;
        }
      });

      // cria o grafo
      const container = document.getElementById("grafo");
      const networkData = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
      const options = {
        layout: { hierarchical: { direction: "LR", sortMethod: "directed" } },
        edges: { smooth: true, arrows: "to" },
        physics: false,
        nodes: { shape: "box", margin: 10, font: { align: "center" } },
      };
      new vis.Network(container, networkData, options);
    })
    .catch(err => {
      document.body.innerHTML = `<h2 style="color:red">Erro ao carregar o JSON: ${err}</h2>`;
      console.error(err);
    });
</script>



</body>
</html>